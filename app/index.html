<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión - Pintura Electrostática</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" type="image/jpeg" href="/app/recursos/LOGO PRISMA.jpg">
    <script>window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-T2RKG90GC5');</script>
</head>

<body class="text-gray-800">

    <!-- **** INICIO DE LA CORRECCIÓN **** -->
    <!-- Nueva Vista para Acceso Denegado -->
    <div id="denied-view" class="hidden min-h-screen flex items-center justify-center bg-gray-100 p-4">
        <div class="w-full max-w-md text-center">
            <img src="/app/recursos/LOGO PRISMA.jpg" alt="Logo Prisma" class="h-16 w-auto mx-auto mb-6">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-xl font-bold mb-4">Acceso Denegado</h2>
                <p id="denied-message" class="text-gray-600">Tu cuenta está pendiente de aprobación.</p>
                <button id="logout-denied-user"
                    class="mt-6 w-full bg-red-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-600">Cerrar
                    Sesión</button>
            </div>
        </div>
    </div>

    <div id="auth-view" class="min-h-screen flex items-center justify-center bg-gray-100 p-4">
        <div class="w-full max-w-md">

            <div class="flex justify-center mb-6">
                <img src="/app/recursos/LOGO PRISMA.jpg" alt="Logo Prisma" class="h-16 w-auto">
            </div>

            <form id="login-form" class="bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold text-center mb-6">Iniciar Sesión</h2>
                <div class="space-y-4">
                    <input type="email" id="login-email" placeholder="Correo Electrónico"
                        class="w-full p-3 border border-gray-300 rounded-lg" required>
                    <input type="password" id="login-password" placeholder="Contraseña"
                        class="w-full p-3 border border-gray-300 rounded-lg" required>
                    <button type="submit"
                        class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700">Ingresar</button>
                </div>
                <p class="text-center mt-4 text-sm">¿No tienes una cuenta? <a href="#" id="show-register-link"
                        class="font-semibold text-indigo-600 hover:underline">Regístrate aquí</a></p>
            </form>

            <form id="register-form" class="hidden bg-white p-8 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold text-center mb-6">Crear Cuenta</h2>
                <div class="space-y-4">
                    <input type="text" id="register-name" placeholder="Nombre Completo"
                        class="w-full p-3 border border-gray-300 rounded-lg" required>
                    <input type="text" id="register-cedula" placeholder="Cédula"
                        class="w-full p-3 border border-gray-300 rounded-lg" required>
                    <input type="tel" id="register-phone" placeholder="Celular"
                        class="w-full p-3 border border-gray-300 rounded-lg" required>
                    <input type="text" id="register-address" placeholder="Dirección"
                        class="w-full p-3 border border-gray-300 rounded-lg">
                    <input type="email" id="register-email" placeholder="Correo Electrónico"
                        class="w-full p-3 border border-gray-300 rounded-lg" required>
                    <input type="password" id="register-password" placeholder="Contraseña (mín. 6 caracteres)"
                        class="w-full p-3 border border-gray-300 rounded-lg" required>
                    <div><label for="register-dob" class="block text-sm font-medium text-gray-700">Fecha de
                            Nacimiento</label><input type="date" id="register-dob"
                            class="w-full p-3 border border-gray-300 rounded-lg mt-1" required></div>

                    <div class="flex items-center space-x-2">
                        <input type="checkbox" id="register-politica"
                            class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" required>
                        <label for="register-politica" class="text-sm text-gray-600">
                            Acepto la <a href="#" id="show-policy-link"
                                class="font-semibold text-indigo-600 hover:underline">Política de Tratamiento de
                                Datos</a>.
                        </label>
                    </div>

                    <button type="submit"
                        class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700">Registrarse</button>
                </div>
                <p class="text-center mt-4 text-sm">¿Ya tienes una cuenta? <a href="#" id="show-login-link"
                        class="font-semibold text-indigo-600 hover:underline">Inicia sesión</a></p>
            </form>
        </div>
    </div>

    <div id="app-view" class="hidden min-h-screen bg-gray-50">
        <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:px-8">
            <header class="mb-4">
                <div class="flex justify-center py-4">
                    <img src="/app/recursos/LOGO PRISMA.jpg" alt="Logo Prisma" class="h-16 w-auto">
                </div>

                <div class="flex flex-col sm:flex-row justify-between sm:items-center gap-4 sm:gap-0">
                    <div>
                        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Sistema de Gestión Integral</h1>
                        <p id="user-info" class="text-gray-600 mt-1">Cargando usuario...</p>
                    </div>
                    <div id="header-actions-container" class="flex items-center gap-3 flex-wrap justify-end">
                        <button id="view-all-loans-btn"
                            class="header-btn bg-blue-600 text-white hover:bg-blue-700 relative hidden">
                            Préstamos Pendientes
                            <span id="header-loan-badge"
                                class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center hidden"></span>
                        </button>
                        <button id="loan-request-btn"
                            class="header-btn bg-yellow-500 text-white hover:bg-yellow-600 hidden">Solicitar
                            Préstamo</button>
                        <button id="summary-btn"
                            class="header-btn bg-green-600 text-white hover:bg-green-700 hidden">Resumen</button>
                        <button id="edit-profile-btn" class="header-btn bg-gray-700 text-white hover:bg-gray-800">Editar
                            Perfil</button>
                        <button id="logout-btn" class="header-btn bg-red-500 text-white hover:bg-red-600">Cerrar
                            Sesión</button>
                    </div>
                </div>
            </header>

            <div class="border-b border-gray-200 mb-6">
                <nav id="main-nav" class="-mb-px flex space-x-6 overflow-x-auto">
                    <button id="tab-remisiones"
                        class="tab-btn active py-4 px-1 text-lg font-semibold text-gray-500 hover:text-gray-800 whitespace-nowrap">Remisiones</button>
                    <button id="tab-mensajes"
                        class="tab-btn py-4 px-1 text-lg font-semibold text-gray-500 hover:text-gray-800 whitespace-nowrap relative">
                        Mensajes
                        <span id="global-unread-badge"
                            class="hidden absolute -top-1 -right-3 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full border-2 border-white">
                            0
                        </span>
                    </button>
                    <button id="tab-facturacion"
                        class="tab-btn py-4 px-1 text-lg font-semibold text-gray-500 hover:text-gray-800 whitespace-nowrap">Facturación</button>
                    <button id="tab-clientes"
                        class="tab-btn py-4 px-1 text-lg font-semibold text-gray-500 hover:text-gray-800 whitespace-nowrap">Clientes</button>
                    <button id="tab-items"
                        class="tab-btn py-4 px-1 text-lg font-semibold text-gray-500 hover:text-gray-800 whitespace-nowrap">Ítems</button>
                    <button id="tab-colores"
                        class="tab-btn py-4 px-1 text-lg font-semibold text-gray-500 hover:text-gray-800 whitespace-nowrap">Colores</button>
                    <button id="tab-gastos"
                        class="tab-btn py-4 px-1 text-lg font-semibold text-gray-500 hover:text-gray-800 whitespace-nowrap">Gastos</button>
                    <button id="tab-proveedores"
                        class="tab-btn py-4 px-1 text-lg font-semibold text-gray-500 hover:text-gray-800 whitespace-nowrap">Proveedores</button>
                    <button id="tab-empleados"
                        class="tab-btn py-4 px-1 text-lg font-semibold text-gray-500 hover:text-gray-800 whitespace-nowrap hidden">Empleados</button>
                </nav>
            </div>
        </div>

        <main class="w-full">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div id="view-remisiones"></div>
                <div id="view-facturacion" class="hidden"></div>
                <div id="view-clientes" class="hidden"></div>
                <div id="view-items" class="hidden"></div>
                <div id="view-colores" class="hidden"></div>
                <div id="view-gastos" class="hidden"></div>
                <div id="view-proveedores" class="hidden"></div>
                <div id="view-empleados" class="hidden"></div>
            </div>

            <div id="view-mensajes" class="hidden w-full h-full pb-6">
                <div class="lg:w-[80%] mx-auto px-4 lg:px-0">
                    <div class="w-full bg-white shadow-2xl flex flex-col md:flex-row overflow-hidden border border-gray-200 rounded-2xl"
                        style="height: calc(100vh - 220px); min-height: 550px;">

                        <div id="wa-contacts-container"
                            class="w-full md:w-80 border-r border-gray-200 flex flex-col bg-white shrink-0">
                            <div class="p-4 border-b flex justify-between items-center bg-gray-50">
                                <h2 class="text-xl font-black text-gray-800">Chats</h2>
                                <span
                                    class="bg-green-100 text-green-700 text-[10px] font-bold px-2 py-1 rounded-full uppercase">API</span>
                            </div>
                            <div id="wa-contacts-list"
                                class="flex-grow overflow-y-auto divide-y divide-gray-100 custom-scrollbar">
                            </div>
                        </div>

                        <div id="wa-chat-area" class="flex-grow flex flex-col bg-[#f0f2f5] relative min-w-0">

                            <div id="wa-no-chat-selected"
                                class="flex-grow flex flex-col items-center justify-center text-gray-400">
                                <div class="bg-white p-6 rounded-full shadow-sm mb-4">
                                    <i class="fa-brands fa-whatsapp text-5xl opacity-20"></i>
                                </div>
                                <p class="font-bold text-sm uppercase tracking-widest">PrismaColor CRM</p>
                            </div>

                            <div id="wa-chat-active" class="hidden flex-grow flex flex-row overflow-hidden">

                                <div class="flex-grow flex flex-col min-w-0 bg-[#e5ddd5] border-r border-gray-200">
                                    <div class="p-3 bg-white border-b shadow-sm flex items-center justify-between">
                                        <div class="flex items-center gap-3 cursor-pointer flex-grow"
                                            id="wa-header-info-trigger">
                                            <button id="wa-back-btn"
                                                class="md:hidden text-gray-500 hover:text-gray-800 pr-2">
                                                <i class="fa-solid fa-arrow-left"></i>
                                            </button>
                                            <div
                                                class="w-10 h-10 bg-indigo-600 rounded-full flex items-center justify-center text-white font-bold shrink-0 shadow-md">
                                                <i class="fa-solid fa-user"></i>
                                            </div>
                                            <div class="min-w-0">
                                                <p id="active-chat-name" class="font-black text-gray-800 truncate"></p>
                                                <div id="wa-window-timer"
                                                    class="text-[10px] font-bold text-emerald-600"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div id="whatsapp-messages-list"
                                        class="flex-grow overflow-y-auto p-4 space-y-3 flex flex-col custom-scrollbar">
                                    </div>

                                    <div class="p-4 bg-white border-t flex items-center gap-2">
                                        <input type="text" id="wa-reply-input" placeholder="Escribe un mensaje..."
                                            class="flex-grow p-3 bg-gray-100 border-none rounded-xl focus:ring-2 focus:ring-green-500 outline-none text-sm">
                                        <button id="wa-send-btn"
                                            class="bg-green-600 text-white w-12 h-12 rounded-xl flex items-center justify-center hover:bg-green-700 transition shadow-md">
                                            <i class="fa-solid fa-paper-plane"></i>
                                        </button>
                                    </div>
                                </div>

                                <div id="wa-client-sidebar"
                                    class="w-72 bg-white flex flex-col hidden lg:flex shrink-0 shadow-inner">
                                    <div
                                        class="p-4 border-b bg-gray-50 font-bold text-xs uppercase tracking-widest text-gray-500 flex justify-between items-center">
                                        <span>Información del Cliente</span>
                                        <button id="close-info-mobile"
                                            class="lg:hidden text-gray-500 text-xl">&times;</button>
                                    </div>

                                    <div class="p-4 space-y-6 overflow-y-auto flex-grow custom-scrollbar">
                                        <div class="grid grid-cols-1 gap-2">
                                            <div class="bg-indigo-50 p-3 rounded-xl border border-indigo-100">
                                                <p class="text-[9px] text-indigo-500 font-black uppercase">Compras Mes
                                                </p>
                                                <p id="wa-side-total-compras"
                                                    class="text-lg font-black text-indigo-900">$ 0</p>
                                            </div>
                                            <div class="bg-rose-50 p-3 rounded-xl border border-rose-100">
                                                <p class="text-[9px] text-rose-500 font-black uppercase">Saldo Deuda</p>
                                                <p id="wa-side-total-deuda" class="text-lg font-black text-rose-900">$ 0
                                                </p>
                                            </div>
                                        </div>
                                        <div>
                                            <p
                                                class="text-[10px] font-bold text-gray-400 mb-2 uppercase tracking-widest text-center">
                                                Facturas Pendientes</p>
                                            <div id="wa-side-remisiones-list" class="space-y-2"></div>
                                        </div>
                                        <div class="pt-4 border-t space-y-2">
                                            <button id="wa-side-report-payment"
                                                class="w-full bg-emerald-600 text-white font-bold py-2 rounded-lg text-xs hover:bg-emerald-700 transition flex items-center justify-center gap-2">
                                                <i class="fa-solid fa-plus"></i> REGISTRAR PAGO
                                            </button>
                                            <button id="wa-side-send-statement"
                                                class="w-full bg-blue-600 text-white font-bold py-2 rounded-lg text-xs hover:bg-blue-700 transition flex items-center justify-center gap-2">
                                                <i class="fa-solid fa-share"></i> ENVIAR ESTADO
                                            </button>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div id="modal-content-wrapper" class="w-full">
            <div id="modal-content" class="bg-white rounded-lg p-6 shadow-xl w-11/12 max-w-sm mx-auto text-center">
            </div>
        </div>
    </div>


    <div id="policy-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl flex flex-col" style="height: 80vh;">
            <div class="flex justify-between items-center p-4 border-b">
                <h2 class="text-xl font-semibold">Política de Tratamiento de Datos</h2>
                <button id="close-policy-modal" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto text-left text-sm">
                <p><strong>Fecha de entrada en vigor:</strong> 15 de julio de 2025</p>
                <br>
                <p>De conformidad con la Ley 1581 de 2012 y el Decreto 1377 de 2013, al registrarse, usted autoriza a
                    <strong>Pinturas industriales PrismaColor S.A.S</strong> para el tratamiento de sus datos
                    personales.
                </p>
                <br>
                <h3 class="font-bold">1. Finalidad:</h3>
                <p>Los datos que usted proporciona (nombre, correo electrónico, cédula, etc.) serán utilizados para:</p>
                <ul class="list-disc list-inside ml-4 my-2">
                    <li>Crear y administrar su cuenta de usuario.</li>
                    <li>Prestar los servicios ofrecidos en la aplicación.</li>
                    <li>Realizar procesos de facturación y gestión de cobro.</li>
                    <li>Contactarlo para notificaciones importantes sobre el servicio.</li>
                    <li>Enviar información sobre nuestros servicios, si usted así lo autoriza.</li>
                </ul>
                <h3 class="font-bold">2. Derechos del Titular:</h3>
                <p>Como titular de la información, usted tiene derecho a conocer, actualizar, rectificar y suprimir sus
                    datos personales, así como a revocar la autorización otorgada.</p>
                <br>
                <h3 class="font-bold">3. Seguridad:</h3>
                <p><strong>Pinturas Industriales PrismaColor S.A.S</strong> se compromete a proteger su información
                    mediante el uso de las herramientas de seguridad apropiadas.</p>
                <br>
                <h3 class="font-bold">4. Contacto:</h3>
                <p>Para cualquier petición, queja o reclamo, puede contactarnos a través del correo electrónico:
                    <strong>gerencia@pinturasprismacolor.com</strong>.
                </p>
                <br>
                <p>Al marcar la casilla de aceptación, usted declara que ha leído y aceptado los términos de esta
                    política de tratamiento de datos.</p>
            </div>
            <div class="p-4 border-t text-right">
                <button id="accept-policy-btn"
                    class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-700">Entendido</button>
            </div>
        </div>
    </div>

    <div id="retencion-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-sm w-full mx-auto text-left">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">Aplicar Retención</h2>
                <button id="close-retencion-modal" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <p class="text-sm text-gray-600 mb-2">Remisión N°: <span id="retencion-remision-num"
                    class="font-bold"></span></p>
            <p class="text-sm text-gray-600 mb-4">Total Actual: <span id="retencion-total-actual"
                    class="font-bold"></span></p>

            <form id="retencion-form" class="space-y-4">
                <input type="hidden" id="retencion-remision-id">

                <div>
                    <label for="retencion-valor" class="block text-sm font-medium">Valor a Descontar</label>
                    <input type="text" id="retencion-valor" class="w-full p-2 border rounded-lg mt-1"
                        inputmode="numeric" required placeholder="0">
                </div>
                <button type="submit"
                    class="w-full bg-orange-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-orange-700">Aplicar
                    Retención</button>
            </form>
        </div>
    </div>

    <div id="saldos-iniciales-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg p-6 shadow-xl max-w-sm w-full mx-auto text-left">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">Saldos Base (Iniciales)</h2>
                <button id="close-saldos-modal" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <p class="text-sm text-gray-600 mb-4">Ingresa el dinero que existía antes de usar el sistema. Esto ajustará
                los totales bancarios.</p>

            <form id="saldos-iniciales-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium">Efectivo Base</label>
                    <input type="text" id="saldo-base-efectivo" class="w-full p-2 border rounded-lg"
                        onfocus="unformatCurrencyInput(this)" onblur="formatCurrencyInput(this)" placeholder="$0">
                </div>
                <div>
                    <label class="block text-sm font-medium">Nequi Base</label>
                    <input type="text" id="saldo-base-nequi" class="w-full p-2 border rounded-lg"
                        onfocus="unformatCurrencyInput(this)" onblur="formatCurrencyInput(this)" placeholder="$0">
                </div>
                <div>
                    <label class="block text-sm font-medium">Davivienda Base</label>
                    <input type="text" id="saldo-base-davivienda" class="w-full p-2 border rounded-lg"
                        onfocus="unformatCurrencyInput(this)" onblur="formatCurrencyInput(this)" placeholder="$0">
                </div>

                <button type="submit"
                    class="w-full bg-teal-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-700">Guardar
                    Saldos</button>
            </form>
        </div>
    </div>

    <script src="https://kit.fontawesome.com/0d623ded97.js" crossorigin="anonymous"></script>
    <script type="module" src="js/app.js"></script>


</body>

</html>